# Development State — 2025-08-25

## Summary
- **E2E PoC working**: Network Admin → publish bundle → Patient App loads bundle, submits encrypted answers → API stores submission → doctor can fetch encrypted blob.
- **Auth**: JWT-based login working. Network Admin gated behind login, patient app still edge/PoC.
- **API**:
  - Fastify v5 + CORS registered.
  - Prisma/Postgres live, schema migrated.
  - Routes in place: `/orgs/*`, `/networks/*`, `/practices/*`, `/submissions/*`.
  - Publish bundle fixed (scope removed, only meta/data saved).
  - Current bundle pointer updates correctly for both orgs and networks.
  - Practice public key endpoints in place.
  - Submissions endpoint returns encrypted blob.
- **Network Admin UI**:
  - Auth gating with Login component.
  - Networks list loads from `/my/networks`.
  - Practices list shows per-network practices.
  - FormBuilder integrated, publishes bundles.
  - Bundles table lists published bundles, with Preview link.
- **Patient App (PoC)**:
  - Loads `?networkId=...` → fetches current bundle.
  - Validates locally, encrypts answers, uploads submission.
  - Upload path tested → API stores blob.
  - Doctor-side decrypt script works (requires PEM).
- **Database**:
  - Seed script creates Org → Demo Network → Demo Practice → Demo Patient.
  - Verified with curl queries.

## Next Steps
1. **Verify live bundle flow**: publish → patient answers → check submissions table.
2. **Network Admin UX pass**: cleaner multi-tenant console layout.
3. **Practice key management**: add UI to upload/view PEM public key.
4. **Doctor submission viewer**: panel to list submissions and fetch blob.
5. **Draft autosave**: per-network draft persisted until publish.
6. **Corporate layer (org → network)**: org bundles promotable into networks.
7. **Auth hardening**: restrict `/networks/:id/*` to members.
8. **Dev ergonomics**: add nodemon/pm2 for API auto-restart.
9. **Documentation**: checkpoint DEV_STATE logs regularly.

## Commands Used
- Seed demo data:  
  `pnpm exec tsx prisma/seed_bootstrap.ts`
- Run API:  
  `pnpm dev` in `apps/api`
- Run Network Admin:  
  `pnpm dev` in `apps/network-admin`
- Run Patient App:  
  `pnpm dev` in `apps/patient-app`
- Kill stale API process:  
  `lsof -i :8787 -t | xargs -r kill -9`

