# Development State – 2025-08-25

## Current Focus
- Fixed **IndependentFormBuilder.jsx** issues:
  - Removed stray corrupt line (`line 1437`).
  - Added export bridge (`window.__rqOnExport`) for legacy compatibility.
  - Normalized `exportFormTemplate` output → now `{ meta, data: { questions } }`.
- Added Prisma models for multitenancy:
  - `User`, `OrgMembership`, `NetworkMembership` with `NetworkRole` enum (`NETWORK_ADMIN`, `NETWORK_MEMBER`, `NETWORK_READONLY`).
  - Seed script `seed_add_membership.ts` creates or ensures a user has `NETWORK_ADMIN` role in demo network.
- Auth:
  - Login via `/auth/login` with email/password returns JWT.
  - UI gated via `auth.ts` (`getToken`, `saveToken`, `clearToken`, `api`).
- Network Admin UI:
  - Now multi-tenant aware. Dropdown shows networks tied to user.
  - Practices load correctly from network context.
  - Bundles can be created and assigned.
- Patient App:
  - PoC working: collects answers, encrypts on device, syncs via API.
  - Submissions round-trip tested; decrypt works with practice key (manual test).
- API:
  - Fastify v5, Prisma v6.14, Postgres local DB.
  - Endpoints: `/auth/login`, `/me`, `/my/networks`, `/networks/:id/practices`, `/networks/:id/bundles`, `/networks/:id/current`, etc.

## Next Steps
1. Verify new bundle publishing works end-to-end (Network Admin → API → Patient App).
2. Add `/submissions` routes to list and fetch blobs.
3. Improve error handling and validation feedback in Patient App.
4. Expand Network Admin UI:
   - Display practice public key.
   - Show submissions table per practice.
   - Improve bundle assignment UX.
5. Long-term: Add Org-level bundles, draft autosave, history view, and Corporate-level overlay.

## Notes
- Dev user: `alex@artisanfertility.com / devpass123`
- Demo Network ID: `cmepx8wh90002bqhy5u76850h`
- Demo Practice ID: `cmepx8whc0004bqhyesch6nqa`
